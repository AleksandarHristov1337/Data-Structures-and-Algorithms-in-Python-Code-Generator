<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DSA Code Tester</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Spinner bar */
        #spinner {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            z-index: 50;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg) translateX(-50%);
            }

            100% {
                transform: rotate(360deg) translateX(-50%);
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen py-10 px-4">

    <div class="max-w-5xl mx-auto bg-white p-8 rounded shadow">
        <h1 class="text-3xl font-bold text-blue-600 mb-6 flex justify-center">üìà DSA Code Execution & Performance</h1>

        <form method="POST" class="space-y-4">
            <label class="block font-semibold text-gray-700 flex justify-center">PYTHON CODE</label>
            <textarea name="code" rows="12"
                class="w-full border rounded p-4 font-mono text-sm">{{ code or '' }}</textarea>

              <div class="flex justify-center gap-5">
                <a 
      href="/"
      class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700" 
    >
      Go Back
    </a>
        <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">
            Run Code
        </button>
    </div>
        </form>

        {% if result %}
        <div class="mt-8">
            <h2 class="text-xl font-semibold text-green-600 mb-2">‚úÖ Output:</h2>
            <pre class="bg-gray-900 text-white p-4 rounded overflow-x-auto">{{ result }}</pre>
        </div>
        {% endif %}

        {% if error %}
        <div class="mt-8">
            <h2 class="text-xl font-semibold text-red-600 mb-2">‚ùå Error:</h2>
            <pre class="bg-red-100 text-red-800 p-4 rounded overflow-x-auto">{{ error }}</pre>
        </div>
        {% endif %}
    </div>

    <!-- Spinner -->
    <div id="spinner"></div>

    <script>
        const perfData = {
            labels: [10, 100, 1000, 10000],
            datasets: [{
                label: 'Your Code Execution Time (s)',
                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                borderColor: 'rgba(59, 130, 246, 1)',
                data: [],
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 5,
                pointBackgroundColor: 'rgba(59, 130, 246, 1)'
            }]
        };

        const config = {
            type: 'line',
            data: perfData,
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'üìä Execution Time vs Input Size (n)',
                        font: {
                            size: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                return `Time: ${context.parsed.y.toFixed(6)} s`;
                            }
                        }
                    },
                    legend: {
                        display: true,
                        labels: {
                            font: { size: 14 }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Input Size (n)',
                            font: { size: 16 }
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Execution Time (seconds)',
                            font: { size: 16 }
                        },
                        beginAtZero: true,
                        type: 'linear',
                        ticks: {
                            callback: function (value) {
                                return value.toFixed(3) + 's';
                            }
                        }
                    }
                }
            }
        };

        async function runBenchmarks() {
            const inputSizes = [10, 100, 1000, 10000];
            const results = [];

            const spinner = document.getElementById("spinner");
            spinner.style.display = "block"; // show spinner

            for (let n of inputSizes) {
                const response = await fetch("/benchmark", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        code: document.querySelector("textarea[name='code']").value,
                        n
                    })
                });
                const json = await response.json();
                results.push(json.time);
            }

            perfData.datasets[0].data = results;

            new Chart(
                document.getElementById("perfChart"),
                config
            );

            spinner.style.display = "none"; // hide spinner
        }

        {% if code %}
        runBenchmarks();
        {% endif %}
    </script>

    <!-- Canvas container for chart -->
    <div class="max-w-5xl mx-auto mt-10">
        <canvas id="perfChart" class="w-full h-96"></canvas>
    </div>

</body>

</html>
